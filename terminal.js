console.log("%c [FPSZERO] SYSTEM INTEGRITY: VERIFIED", "color:#00ff00;background:#000;padding:4px;");
console.log("%c [FPSZERO] PROTOCOL: OMEGA-7 ACTIVE", "color:#00ff00;background:#000;padding:4px;");
/* FPSZERO SECURE TRANSMISSION
   UNAUTHORIZED DECOMPILATION PROHIBITED
   ---------------------------------------
*/
const output=document.getElementById('terminal-output');const inputLine=document.getElementById('command-input');const inputContainer=document.getElementById('input-line');const prefix=document.getElementById('prompt-prefix');let history=[];let historyIndex=-1;let currentPath=['home'];let fileSystem={};let username=sessionStorage.getItem('fps_username')|| null;let isMuted=localStorage.getItem('fps_mute')==='true';let isLoginMode=false;let isAnimating=false;const startTime=new Date();const audioCtx=new(window.AudioContext || window.webkitAudioContext)();function escapeHTML(str){return str.replace(new RegExp("[&<>'\"]","g"),tag=>({'&':'&amp;','<':'&lt;','>':'&gt;',"'":'&#39;','"':'&quot;'}[tag]));}const baseSystem={'home':{},'bin':{'ls':'[Ex]','cat':'[Ex]','pwd':'[Ex]','whoami':'[Ex]','date':'[Ex]','status':'[Ex]','reboot':'[Ex]','sound':'[Ex]','uname':'[Ex]','uptime':'[Ex]','top':'[Ex]','history':'[Ex]','mkdir':'[Ex]'},'var':{'log':{'syslog':'Daemon started.\nSentinel Engine: LISTENING.'}}};function getLiveMoonTelemetry(){const synodic=29.53058867;const baseDate=new Date('1970-01-07T20:35:00Z').getTime();const now=new Date().getTime();const msPerDay=1000*60*60*24;const days=(now-baseDate)/msPerDay;const frac=(days % synodic)/synodic;let name="New Moon";if(frac>0.03 && frac<0.23)name="Waxing Crescent";else if(frac>=0.23 && frac<=0.27)name="First Quarter";else if(frac>0.27 && frac<0.47)name="Waxing Gibbous";else if(frac>=0.47 && frac<=0.53)name="Full Moon";else if(frac>0.53 && frac<0.73)name="Waning Gibbous";else if(frac>=0.73 && frac<=0.77)name="Last Quarter";else if(frac>0.77 && frac<0.97)name="Waning Crescent";const angle=frac*Math.PI*2;const vis=Math.round(50*(1-Math.cos(angle)));return `${name} [Vis: ${vis}%]`;}function saveSystem(){localStorage.setItem('fps_filesystem',JSON.stringify(fileSystem));}const COMMANDS={'help':()=>{print("FPSZERO SHELL v1.0.2");print("--------------------");print("  ls, cd, cat, pwd    : File System Navigation");print("  mkdir               : Create Directory");print("  date, uptime        : Time Information");print("  status, uname, top  : System Information");print("  sound [on/off]      : Toggle Audio Feedback");print("  whoami, history     : User Information");print("  reboot              : System Reset (Logout)");print("  clear               : Clear Display");},'date':()=>{print(new Date().toString());},'uptime':()=>{const now=new Date();const diff=Math.floor((now-startTime)/1000);const mins=Math.floor(diff/60);const secs=diff % 60;print(`up ${mins} min, ${secs} sec, 1 user, load average: 0.02, 0.05, 0.01`);},'uname':(args)=>{if(args[0]==='-a')print("Linux fpszero-node 1.0.0-generic #42-static FPS x86_64 Github Pages");else print("Github Pages");},'top':()=>{print("PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND");print("  1 root      20   0  168856  13068   8368 S   0.0   0.1   0:02.14 systemd");print(" 42 root      20   0   12.8g  98.2m  42.1m S   0.3   0.6   0:55.32 sentinel_daemon");print(`101 ${username || 'guest'}   20   0   82444   5620   3890 R   0.1   0.0   0:00.05 fps_shell`);},'status':()=>{print("System Status: NOMINAL");print("Security Level: Unknown");const moonInfo=getLiveMoonTelemetry();print(`Astro Telemetry: [Moon: ${moonInfo}]`);const jsHeap=performance.memory ? Math.round(performance.memory.usedJSHeapSize/1024/1024):15;const vramEst=140;print(`Heap Allocation: ${jsHeap} MB [Active Scripting]`);print(`GPU Reservation: ~${vramEst} MB [Visual Processing]`);},'sound':(args)=>{if(args[0]==='off'){isMuted=true;print("Audio feedback: DISABLED");}else if(args[0]==='on'){isMuted=false;print("Audio feedback: ENABLED");playTypeSound();}else{isMuted=!isMuted;print(`Audio feedback: ${isMuted ? 'DISABLED' : 'ENABLED'}`);if(!isMuted)playTypeSound();}localStorage.setItem('fps_mute',isMuted);},'reboot':()=>{print("Initiating shutdown sequence...");print("Clearing session data...");print("Purging local file system cache...");sessionStorage.clear();localStorage.removeItem('fps_filesystem');setTimeout(()=>location.reload(),1000);},'history':()=>{history.forEach((cmd,i)=>print(`${i + 1}  ${cmd}`));},'whoami':()=>print(username),'pwd':()=>print(getPathString()),'clear':()=>output.innerHTML='','ls':()=>{const dir=getDir(currentPath);if(!dir)return;const items=Object.keys(dir).map(key=>{if(typeof dir[key]==='object')return `<span class="dir">${key}/</span>`;if(key.endsWith('.link'))return `<span class="link">${key}</span>`;return `<span class="file">${key}</span>`;});print(items.join('  '));},'cd':(args)=>{if(!args[0] || args[0]==='~'){currentPath=['home',username];}else if(args[0]==='..'){if(currentPath.length>0)currentPath.pop();}else{const newDir=getDir([...currentPath,args[0]]);if(newDir && typeof newDir==='object'){currentPath.push(args[0]);}else{print(`cd: ${args[0]}: No such file or directory`,'error');}}updatePrompt();},'mkdir':(args)=>{if(!args[0]){print("usage: mkdir [directory]",'error');return;}const dirName=args[0];const currentDirObj=getDir(currentPath);if(currentDirObj[dirName]){print(`mkdir: cannot create directory '${dirName}': File exists`,'error');}else{currentDirObj[dirName]={};saveSystem();}},'cat':(args)=>{if(!args[0]){print("usage: cat [file]");return;}const dirContent=getDir(currentPath);const fileContent=dirContent ? dirContent[args[0]]:null;if(fileContent){if(typeof fileContent==='object'){print(`cat: ${args[0]}: Is a directory`,'error');}else{if(args[0].endsWith('.link')){print(`Opening uplink...`);setTimeout(()=>window.open(fileContent,'_blank'),500);}else{print(fileContent);}}}else{print(`cat: ${args[0]}: No such file`,'error');}},'matrix':()=>triggerMatrixRain()};function init(){buildFileSystem();document.addEventListener('click',()=>{if(!isAnimating)inputLine.focus();});if(!username){startLoginSequence();}else{restoreSession();}}function startLoginSequence(){print("FPSZERO SECURE GATEWAY v5.1");print("---------------------------");print("UNAUTHORIZED ACCESS DETECTED.");print("IDENTITY CONFIRMATION REQUIRED.");isLoginMode=true;inputContainer.classList.remove('hidden');prefix.textContent="CODENAME: ";inputLine.value='';inputLine.classList.add('password-mode');setTimeout(()=>inputLine.focus(),50);}function restoreSession(){setupUserEnvironment(username);print(`System restored. Welcome back, ${username}.`);const moonInfo=getLiveMoonTelemetry();print(`Astro Telemetry: [Moon: ${moonInfo}]`);inputContainer.classList.remove('hidden');inputLine.focus();}function setupUserEnvironment(name){username=name;sessionStorage.setItem('fps_username',username);currentPath=['home',username];const savedSystem=localStorage.getItem('fps_filesystem');if(savedSystem){fileSystem=JSON.parse(savedSystem);}else{const coreSystemsData=JSON.parse(localStorage.getItem('fps_core_systems')|| '{}');const dynamicProducts={};Object.keys(coreSystemsData).forEach(key=>{const project=coreSystemsData[key];const folderName=key.toLowerCase().replace(/[^a-z0-9]+/g,'-');dynamicProducts[folderName]={'README.txt':project.details.description,'status.log':project.isPulsar ? 'STATUS: FORMING [PULSAR ACTIVE]':'STATUS: STABLE'};if(project.details.ctas){project.details.ctas.forEach(cta=>{const linkName=cta.label.toLowerCase().replace(/[^a-z0-9]+/g,'_')+'.link';dynamicProducts[folderName][linkName]=cta.url;});}});if(!baseSystem['home'][username]){baseSystem['home'][username]={'products':dynamicProducts,'manifesto':`...`,'shadow_sector':{'moon_truth.txt':`SYSTEM NOTE: CELESTIAL SIMULATION ACTIVE
                    <br>----------------------------------------
                    <br>The moon you see in the sky is not a static asset.
                    <br>It is a procedural 3D body, physically located at vector [35, 25, -50].
                    <br><br>
                    Its phase is calculated in real-time based on the current UTC timestamp relative to the Lunar Synodic Month (29.53 days).
                    <br><br>
                    The lighting you see is a dynamic DirectionalLight orbiting the mesh to simulate the exact angle of incidence from the Sun, corrected for your viewing angle.
                    <br><br>
                    We do not fake data. We simulate physics.`,'coordinates.log':"Vector3 { x: 35, y: 25, z: -50 } | Texture: LROC_WAC_Global_Mosaic"}};}fileSystem=JSON.parse(JSON.stringify(baseSystem));localStorage.setItem('fps_filesystem',JSON.stringify(fileSystem));}updatePrompt();}function playTypeSound(){if(isMuted)return;if(audioCtx.state==='suspended')audioCtx.resume();const osc=audioCtx.createOscillator();const gainNode=audioCtx.createGain();osc.connect(gainNode);gainNode.connect(audioCtx.destination);osc.type='square';osc.frequency.setValueAtTime(800+Math.random()*200,audioCtx.currentTime);gainNode.gain.setValueAtTime(0.05,audioCtx.currentTime);osc.start();osc.stop(audioCtx.currentTime+0.05);}inputLine.addEventListener('keydown',(e)=>{if(e.key.length===1)playTypeSound();if(e.key==='Enter'){const inputVal=inputLine.value.trim();if(isLoginMode)handleLogin(inputVal);else handleCommand(inputVal);}else if(!isLoginMode){if(e.key==='ArrowUp'){e.preventDefault();if(historyIndex>0){historyIndex--;inputLine.value=history[historyIndex];}}else if(e.key==='ArrowDown'){e.preventDefault();if(historyIndex<history.length-1){historyIndex++;inputLine.value=history[historyIndex];}else{historyIndex=history.length;inputLine.value='';}}else if(e.key==='Tab'){e.preventDefault();autoComplete(inputLine.value);}}});function handleLogin(name){if(!name)return;inputLine.value='';inputContainer.classList.add('hidden');isLoginMode=false;inputLine.classList.remove('password-mode');runMatrixWakeUp(name);}function handleCommand(command){if(!command)return;const safeCommand=escapeHTML(command);print(`${safeCommand}`,'command-history');history.push(command);historyIndex=history.length;const parts=command.split(' ');const cmd=parts[0].toLowerCase();const args=parts.slice(1);if(COMMANDS[cmd]){COMMANDS[cmd](args);}else{print(`${safeCommand}: command not found`,'error');}inputLine.value='';scrollToBottom();}function print(text,type=''){const div=document.createElement('div');div.className=`log-line ${type}`;div.innerHTML=text.replace(/\n/g,'<br>');output.appendChild(div);scrollToBottom();}function getDir(pathArray){let current=fileSystem;for(const part of pathArray){if(current[part]){current=current[part];}else{return null;}}return current;}function getPathString(){return '/'+currentPath.join('/');}function updatePrompt(){const path=getPathString();const displayPath=path.replace(`/home/${username}`,'~');prefix.textContent=`${username}@fpszero.com:${displayPath}$`;}function scrollToBottom(){window.scrollTo(0,document.body.scrollHeight);}function autoComplete(input){const parts=input.split(' ');const partial=parts[parts.length-1];const dir=getDir(currentPath);if(!dir)return;const matches=Object.keys(dir).filter(o=>o.startsWith(partial));if(matches.length===1){parts[parts.length-1]=matches[0];inputLine.value=parts.join(' ');}}function buildFileSystem(){fileSystem=JSON.parse(JSON.stringify(baseSystem));}function delay(ms){return new Promise(resolve=>setTimeout(resolve,ms));}async function runMatrixWakeUp(name){isAnimating=true;output.innerHTML='';await typeWriter(`Booting FPSZERÃ˜...`,80);await delay(1500);output.innerHTML='';await typeWriter(`Wake up, ${name}...`,80);await delay(1500);output.innerHTML='';await typeWriter(`The Matrix has you...`,80);await delay(1500);output.innerHTML='';await typeWriter(`Follow the white rabbit.`,80);await delay(1000);output.innerHTML='';setupUserEnvironment(name);print(`Identity Verified: [${name}]`);print("FPSZERO Environment Loaded.");print("Type <span class=\"link\">'help'</span> to list modules.");inputContainer.classList.remove('hidden');inputLine.focus();isAnimating=false;}function typeWriter(text,speed){return new Promise(resolve=>{const div=document.createElement('div');div.className='matrix-text';output.appendChild(div);let i=0;function type(){if(i<text.length){div.innerHTML+=text.charAt(i);playTypeSound();i++;setTimeout(type,speed);}else resolve();}type();});}function triggerMatrixRain(){const canvas=document.createElement('canvas');canvas.style.position='fixed';canvas.style.top='0';canvas.style.left='0';canvas.style.width='100%';canvas.style.height='100%';canvas.style.zIndex='9999';canvas.style.opacity='0.8';document.body.appendChild(canvas);const ctx=canvas.getContext('2d');canvas.width=window.innerWidth;canvas.height=window.innerHeight;const alphabet='01';const fontSize=16;const columns=canvas.width/fontSize;const rainDrops=Array(Math.floor(columns)).fill(1);const draw=()=>{ctx.fillStyle='rgba(0, 0, 0, 0.05)';ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle='#0F0';ctx.font=fontSize+'px monospace';for(let i=0;i<rainDrops.length;i++){const text=alphabet.charAt(Math.floor(Math.random()*alphabet.length));ctx.fillText(text,i*fontSize,rainDrops[i]*fontSize);if(rainDrops[i]*fontSize>canvas.height && Math.random()>0.975)rainDrops[i]=0;rainDrops[i]++;}};const interval=setInterval(draw,30);canvas.addEventListener('click',()=>{clearInterval(interval);canvas.remove();});}init();